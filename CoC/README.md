# Command and Control with Empire

With a foothold in a target network, we can start looking to bring what is known as a C2 (Command and Control) Framework into play. C2 Frameworks are used to consolidate an attacker's position within a network and simplify post-exploitation steps (privesc, AV evasion, pivoting, looting, covert network tactics, etc), as well as providing red teams with extensive collaboration features.

Powershell Empire is, as the name suggests, a framework built primarily to attack Windows targets (although especially with the advent of dotnet core, more and more of the functionality may become usable in other systems). It provides a wide range of modules to take initial access to a network of devices, and turn it into something much bigger. In this section we will be looking at the principles

---

## 1.0 Empire information

- **Listeners**Â are fairly self-explanatory. They listen for a connection and facilitate further exploitation
- **Stagers**Â are essentially payloads generated by Empire to create a robust reverse shell in conjunction with a listener. They are the delivery mechanism for agents
- **Agents**Â are the equivalent of a Metasploit "Session". They are connections to compromised targets, and allow an attacker to further interact with the system
- **Modules**Â are used to in conjunction with agents to perform further exploitation. For example, they can work through an existing agent to dump the password hashes from the server

---

## 2.0 Downloading Empire

```bash
sudo apt install powershell-empire starkiller
```

## 3.0 Commands

Starting empire server:

```bash
sudo powershell-empire server
```

Exit menu

```bash
back
```

Go back to main

```bash
main
```

Starting empire client:

```bash
sudo powershell-empire client
```

---

## 4.0 Empire Listeners

Listeners in Empire are used to receive connections from stagers (which we'll look at in the next task). The default listener is the HTTP listener. This is what we will be using here, although there are many others available. It's worth noting that a single listener can be used more than once -- they do not die after their first usage.

Select a listener trough the client:

```bash
uselistener LISTENER
```

Example:

```bash
uselistener http
```

Set options for the listener

```bash
set OPTION VALUE
```

- Example:
    
    ```bash
    set Host 10.50.10.5
    ```
    

Run the listener:

```bash
execute
```

<aside>
ðŸ“Œ Bear in mind that option names are case sensitive in Empire.

</aside>

---

## 5.0 Stagers

Stagers are Empire's payloads. They are used to connect back to waiting listeners, creating an agent when executed.

Use a stager: (When in doubt, multi/launcher is often a good bet.)

```bash
usestager {stager}
```

Set options:

```bash
set OPTION VALUE
```

- Example:
    
    ```bash
    set LISTENER <listener>
    ```
    

---

## 6.0 Agents

Now that we've started a listener and created a stager, it's time to put them together to get an agent!

List agents:

```bash
agents
```

Interact with agent:

```bash
interact AGENT_NAME
```

---

## 7.0 Hop Listeners

Hop Listeners create what looks like a regular listener in our list of listeners (like the http listener we used before); however, rather than opening a port to receive a connection, hop listeners create files to be copied across to the compromised "jump" server and served from there. These files contain instructions to connect back to a normal (usually HTTP) listener on our attacking machine.

Use http hop listener:

```bash
uselistener http_hop
```
[5 ) PersonalPC](/PersonalPC/README.md)